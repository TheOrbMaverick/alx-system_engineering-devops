#!/usr/bin/env bash
# Script to configure Nginx with a custom HTTP response header

# Add custom header to Nginx configuration file
add_custom_header() {
    # Check if the correct number of arguments is provided
    if [ "$#" -ne 1 ]; then
        echo "Usage: $0 CONFIG_FILE_PATH" >&2
        exit 1
    fi

    local config_file="$1"
    local hostname=$(hostname)
    local header="add_header X-Served-By $hostname;"

    # Add the header to the Nginx configuration file
    if ! sudo sed -i "/server {/a $header" "$config_file"; then
        echo "Failed to add custom header to $config_file" >&2
        exit 1
    fi
}

# Main function
main() {
    local config_file="/etc/nginx/sites-available/itaenang.tech"

    # Call the function to add the custom header
    add_custom_header "$config_file"

    # Reload Nginx to apply the changes
    if ! sudo service nginx reload; then
        echo "Failed to reload Nginx configuration" >&2
        exit 1
    fi

    echo "Nginx configured successfully with custom HTTP response header"
}

# Call the main function
main
