#!/usr/bin/env bash
# Script to configure Nginx with custom HTTP response header

# List of servers
servers=("519510-web-01" "519510-web-02")

# Function to add custom header to Nginx configuration file
add_custom_header() {
    local server=$1
    local header="add_header X-Served-By $(hostname);"
    local config_file="/etc/nginx/sites-available/itaenang.tech"
    
    # SSH into the server and add the header to the Nginx config file
    ssh $server "sudo sed -i '/server {/a $header' $config_file"
    
    # Restart Nginx to apply the changes using service command
    ssh $server "sudo service nginx restart"
}

# Main function
main() {
    for server in "${servers[@]}"; do
        echo "Adding custom header to Nginx configuration on $server..."
        add_custom_header "$server"
        echo "Custom header added to Nginx configuration on $server"
    done
}

main
